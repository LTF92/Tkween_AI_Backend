# تصميم النظام - منصة تكوين للشعر العربي بالذكاء الاصطناعي
# System Design - Tkween Arabic Poetry AI Platform

---

## 1. نظرة عامة (Overview)

### 1.1 وصف النظام
نظام ذكي لتوليد الشعر العربي باستخدام تقنيات الذكاء الاصطناعي التوليدي (Generative AI). يتيح النظام للمستخدمين إنشاء قصائد عربية فصيحة موزونة ومقفّاة بناءً على العنوان والتفاصيل المطلوبة.

### 1.2 الأهداف
- توليد قصائد عربية موزونة ومقفّاة
- دعم تحديد البحر الشعري المطلوب
- ضمان سلامة اللغة العربية الفصحى
- تجربة مستخدم بسيطة وسريعة

---

## 2. هيكلية النظام (System Architecture)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           CLIENT LAYER                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────────────────┐      │
│  │                     Web Application                                │      │
│  │              (Vanilla HTML / CSS / JavaScript)                     │      │
│  │                   Hosted on Cloudflare Pages                       │      │
│  └───────────────────────────────┬───────────────────────────────────┘      │
│                                  │                                           │
└──────────────────────────────────┼───────────────────────────────────────────┘
                                   │ HTTPS
                                   ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         GATEWAY LAYER                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      Cloudflare CDN                                  │    │
│  │              (SSL/TLS, DDoS Protection, Caching)                     │    │
│  └──────────────────────────────┬──────────────────────────────────────┘    │
│                                 │                                            │
│  ┌──────────────────────────────▼──────────────────────────────────────┐    │
│  │                         Nginx                                        │    │
│  │              (Reverse Proxy, Load Balancing)                         │    │
│  └──────────────────────────────┬──────────────────────────────────────┘    │
└─────────────────────────────────┼────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                       APPLICATION LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      FastAPI Server                                  │    │
│  │                    (Python 3.12, Uvicorn)                           │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  ┌──────────────────────────┐  ┌──────────────────────────┐         │    │
│  │  │      Poem Generator     │  │      Stats Handler       │         │    │
│  │  │    (POST /poems)        │  │      (GET /stats)        │         │    │
│  │  └────────────┬────────────┘  └────────────┬─────────────┘         │    │
│  │               │                            │                        │    │
│  │  ┌──────▼─────────────────▼─────────────────▼───────┐               │    │
│  │  │              CORS Middleware                      │               │    │
│  │  │         (Cross-Origin Resource Sharing)          │               │    │
│  │  └──────────────────────────────────────────────────┘               │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                   │
                                   │ API Request
                                   ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              AI LAYER                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                           OpenAI API                                   │  │
│  ├───────────────────────────────────────────────────────────────────────┤  │
│  │                                                                        │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │  │
│  │  │                     ChatGPT-5.2                                  │  │  │
│  │  │  ─────────────────────────────────────────────────────────────  │  │  │
│  │  │  • توليد القصائد العربية الفصيحة                                │  │  │
│  │  │  • الالتزام بالوزن والقافية                                      │  │  │
│  │  │  • Temperature: 0.6 للدقة والاتساق                               │  │  │
│  │  │  • Response Format: JSON                                         │  │  │
│  │  └─────────────────────────────────────────────────────────────────┘  │  │
│  │                                                                        │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. مكونات النظام (System Components)

### 3.1 طبقة العميل (Client Layer)

| المكون | التقنية | الوصف |
|--------|---------|-------|
| تطبيق الويب | Vanilla HTML/CSS/JS | واجهة المستخدم الرسومية |
| الاستضافة | Cloudflare Pages | استضافة سحابية سريعة |
| التصميم | CSS Modern | تصميم متجاوب وحديث |

### 3.2 طبقة البوابة (Gateway Layer)

| المكون | الوظيفة |
|--------|---------|
| Cloudflare | حماية DDoS، شهادات SSL، التخزين المؤقت |
| Nginx | Reverse Proxy، موازنة الحمل، إعادة التوجيه |

### 3.3 طبقة التطبيق (Application Layer)

| المكون | التقنية | الوظيفة |
|--------|---------|---------|
| FastAPI | Python 3.12 | إطار العمل الرئيسي |
| Uvicorn | ASGI Server | خادم غير متزامن عالي الأداء |
| Pydantic | Data Validation | التحقق من صحة البيانات |

### 3.4 طبقة الذكاء الاصطناعي (AI Layer)

| النموذج | الوظيفة | المواصفات |
|---------|---------|-----------|
| ChatGPT-5.2 | توليد القصائد | نموذج لغوي كبير متقدم |
| - | Temperature: 0.6 | للحصول على نتائج دقيقة ومتسقة |

### 3.5 طبقة البيانات (Data Layer)

| المكون | النوع | الوصف |
|--------|-------|-------|
| لا يوجد قاعدة بيانات | - | النظام يعتمد على OpenAI API مباشرة |
| Environment Variables | .env | تخزين مفاتيح API |

---

## 4. تدفق البيانات (Data Flow)

### 4.1 إنشاء قصيدة جديدة

```
┌──────────────┐         ┌──────────────┐         ┌──────────────┐
│              │  POST   │              │  API    │              │
│    Client    │────────▶│   FastAPI    │────────▶│   OpenAI     │
│   (Browser)  │         │   Server     │         │   ChatGPT-5.2     │
│              │         │              │         │              │
└──────────────┘         └──────────────┘         └──────┬───────┘
                                                         │
       ┌─────────────────────────────────────────────────┘
       │ Generated Poem (JSON)
       ▼
┌──────────────┐         ┌──────────────┐
│   Format     │         │   Display    │
│   Response   │────────▶│   to User    │
│              │         │              │
└──────────────┘         └──────────────┘
```

### 4.2 تفاصيل الطلب والاستجابة

```
Request:                              Response:
{                                     {
  "choice": "إنشاء قصيدة",              "title": "عنوان القصيدة",
  "title": "العنوان",                   "verses": [
  "title_details": "تفاصيل",              "البيت الأول...",
  "verses_count": 4,                      "البيت الثاني..."
  "meter": "الطويل"                     ],
}                                       "meter": "الطويل"
                                      }
```

---

## 5. تصميم API (API Design)

### 5.1 نقاط النهاية (Endpoints)

```yaml
Base URL: https://api.tkween.co

Endpoints:
  POST /poems:
    description: إنشاء قصيدة عربية جديدة
    request_body:
      choice: "إنشاء قصيدة"
      title: string (required) - عنوان القصيدة
      title_details: string (optional) - تفاصيل إضافية
      verses_count: integer (required) - عدد الأبيات
      meter: string (optional) - البحر الشعري
    responses:
      200: CreatePoemResponse
      400: ValidationError
      500: InternalError

  GET /stats:
    description: معلومات عن النظام
    responses:
      200: StatsResponse

  GET /:
    description: معلومات API
    responses:
      200: InfoResponse
```

### 5.2 نماذج البيانات (Data Models)

```python
# طلب القصيدة
class PoemRequest:
    choice: Literal["إنشاء قصيدة"]
    title: str                    # عنوان القصيدة (مطلوب)
    title_details: Optional[str]  # تفاصيل إضافية (اختياري)
    verses_count: int             # عدد الأبيات (مطلوب)
    meter: Optional[str]          # البحر الشعري (اختياري)

# استجابة إنشاء القصيدة
class CreatePoemResponse:
    title: str          # عنوان القصيدة
    verses: List[str]   # قائمة الأبيات
    meter: str          # البحر الشعري المستخدم
```

---

## 6. البنية التحتية (Infrastructure)

### 6.1 مكونات النظام

```
┌─────────────────────────────────────────────────────────────┐
│                    Production Environment                    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────┐         ┌─────────────────┐           │
│  │  Cloudflare     │         │  VPS Server     │           │
│  │  Pages          │         │  (Linode)       │           │
│  │  ─────────────  │         │  ─────────────  │           │
│  │  Frontend       │◀───────▶│  Backend API    │           │
│  │  tkween.co      │  HTTPS  │  api.tkween.co  │           │
│  └─────────────────┘         └────────┬────────┘           │
│                                       │                     │
│                                       │ API Call            │
│                                       ▼                     │
│                              ┌─────────────────┐           │
│                              │   OpenAI API    │           │
│                              │   (ChatGPT-5.2)      │           │
│                              └─────────────────┘           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 6.2 تفاصيل الخوادم

| الخادم | الوظيفة | التقنية |
|--------|---------|---------|
| Frontend | واجهة المستخدم | Cloudflare Pages |
| Backend | API Server | VPS + FastAPI + Uvicorn |
| AI | توليد القصائد | OpenAI ChatGPT-5.2 |

### 6.3 البيئة البرمجية

```bash
# Server Environment
Python: 3.12+
FastAPI: 0.115.6
Uvicorn: 0.34.0
OpenAI SDK: 1.58.1
```

---

## 7. خوارزمية توليد القصائد (Poem Generation Algorithm)

### 7.1 مخطط الخوارزمية

```
Algorithm: GeneratePoem(title, title_details, verses_count, meter)

Input:
  - title: عنوان القصيدة
  - title_details: تفاصيل إضافية (اختياري)
  - verses_count: عدد الأبيات
  - meter: البحر الشعري (اختياري)

Output:
  - poem: قصيدة موزونة ومقفّاة

Procedure:
  1. prompt ← BuildPrompt(title, title_details, verses_count, meter)
  
  2. response ← OpenAI.ChatCompletion(
       model="gpt-5.2",
       messages=[system_prompt, user_prompt],
       temperature=0.6,
       response_format="json"
     )
  
  3. poem ← ParseJSON(response)
  
  4. RETURN {
       title: poem.title,
       verses: poem.verses,
       meter: poem.meter
     }
```

### 7.2 Prompt Engineering (هندسة المحثّات)

```python
SYSTEM_PROMPT = """
أنت شاعر عربي فصيح من الطراز الأول.
تتقن علم العروض وبحور الشعر العربي.
تلتزم بالوزن والقافية في كل قصيدة.
ترد دائماً بصيغة JSON فقط.
"""

USER_PROMPT = """
أنت شاعر عربي فصيح، متمكن من علم العروض والقافية.

═══════════════════════════════════════
المطلوب: إنشاء قصيدة عربية فصيحة
═══════════════════════════════════════

عنوان القصيدة: {title}
{title_details}
عدد الأبيات: {verses_count}
{meter_instruction}

═══════════════════════════════════════
قواعد الوزن والقافية:
═══════════════════════════════════════
1. كل بيت يتكون من شطرين (صدر وعجز)
2. الوزن العروضي متطابق في جميع الأبيات
3. القافية موحدة في نهاية كل بيت
4. الروي (حرف القافية) ثابت لا يتغير

═══════════════════════════════════════
قواعد اللغة:
═══════════════════════════════════════
1. لغة عربية فصيحة صحيحة نحوياً وصرفياً
2. تجنب الكلمات الغريبة أو المبهمة
3. المعنى واضح ومترابط بين الأبيات
4. الألفاظ جزلة وبليغة تناسب الموضوع

الرد بصيغة JSON:
{
  "title": "...",
  "verses": ["البيت 1", "البيت 2", ...],
  "meter": "اسم البحر",
  "rhyme": "حرف الروي"
}
"""
```

### 7.3 معاملات النموذج (Model Parameters)

| المعامل | القيمة | السبب |
|---------|--------|-------|
| model | gpt-5.2 | أفضل جودة للشعر العربي |
| temperature | 0.6 | توازن بين الإبداع والدقة |
| response_format | json_object | ضمان استجابة منظمة |

---

## 8. متطلبات النظام (System Requirements)

### 8.1 متطلبات الأجهزة (Backend Server)

| المكون | الحد الأدنى | الموصى به |
|--------|-------------|-----------|
| RAM | 1 GB | 2 GB |
| CPU | 1 core | 2 cores |
| Storage | 5 GB SSD | 10 GB SSD |
| Network | 50 Mbps | 100 Mbps |

### 8.2 متطلبات البرمجيات

```yaml
Backend:
  Runtime:
    - Python: 3.12+
  
  Dependencies:
    - fastapi: 0.115.6
    - uvicorn: 0.34.0
    - openai: 1.58.1
    - pydantic: 2.10.4
    - python-dotenv: 1.0.1

Frontend:
  - HTML5
  - CSS3
  - Vanilla JavaScript (ES6+)

External Services:
  - OpenAI API (ChatGPT-5.2)
  - Cloudflare Pages (Frontend Hosting)
  - Cloudflare DNS
```

---

## 9. الأمان (Security)

### 9.1 طبقات الحماية

```
┌─────────────────────────────────────────────┐
│            Security Layers                   │
├─────────────────────────────────────────────┤
│ 1. Cloudflare WAF (Web Application Firewall)│
│ 2. DDoS Protection                          │
│ 3. SSL/TLS Encryption (HTTPS)               │
│ 4. CORS Policy                              │
│ 5. Input Validation (Pydantic)              │
│ 6. API Key Protection (.env)                │
│ 7. Rate Limiting (Future)                   │
└─────────────────────────────────────────────┘
```

### 9.2 إعدادات CORS

```python
CORS_CONFIG = {
    "allow_origins": [
        "https://tkween.co",
        "https://www.tkween.co",
        "https://tkween.pages.dev"
    ],
    "allow_methods": ["*"],
    "allow_headers": ["*"],
    "allow_credentials": True
}
```

---

## 10. قابلية التوسع (Scalability)

### 10.1 التوسع الأفقي

```
                    ┌─────────────┐
                    │ Load        │
                    │ Balancer    │
                    └──────┬──────┘
           ┌───────────────┼───────────────┐
           │               │               │
           ▼               ▼               ▼
    ┌──────────┐    ┌──────────┐    ┌──────────┐
    │ Server 1 │    │ Server 2 │    │ Server 3 │
    │ FastAPI  │    │ FastAPI  │    │ FastAPI  │
    └────┬─────┘    └────┬─────┘    └────┬─────┘
         │               │               │
         └───────────────┼───────────────┘
                         │
                         ▼
              ┌──────────────────┐
              │    OpenAI API    │
              │     (ChatGPT-5.2)     │
              └──────────────────┘
```

### 10.2 استراتيجيات التحسين

| الاستراتيجية | الوصف |
|--------------|-------|
| Response Caching | تخزين القصائد المتكررة مؤقتاً |
| Connection Pooling | إعادة استخدام اتصالات OpenAI |
| Async Processing | معالجة غير متزامنة للطلبات |
| CDN | تقديم الفرونت إند من Cloudflare Edge |

---

## 11. المراقبة والتسجيل (Monitoring & Logging)

### 11.1 المقاييس المُراقَبة

```yaml
Performance Metrics:
  - Response Time (p50, p95, p99)
  - Request Rate (req/sec)
  - Error Rate (%)
  - CPU Usage (%)
  - Memory Usage (%)

Business Metrics:
  - Poems Generated/day
  - Unique Users/day
  - Popular Topics
  - Popular Meters
```

### 11.2 تنسيق السجلات

```json
{
  "timestamp": "2025-12-20T10:30:00Z",
  "level": "INFO",
  "service": "tkween-api",
  "endpoint": "/poems",
  "method": "POST",
  "status": 200,
  "duration_ms": 3500,
  "request": {
    "choice": "إنشاء قصيدة",
    "title": "الحب",
    "verses_count": 4
  }
}
```

---

## 12. خطة التطوير المستقبلية (Future Roadmap)

### 12.1 المرحلة القادمة (v2.0)

- [ ] تحسين دقة الوزن والقافية
- [ ] إضافة تشكيل تلقائي للقصائد
- [ ] دعم الشعر الحر والتفعيلة
- [ ] إضافة خاصية الاستشهاد بقصائد تراثية
- [ ] تطبيق جوال (iOS/Android)

### 12.2 التحسينات التقنية

- [ ] تطبيق Rate Limiting
- [ ] إضافة Redis Cache
- [ ] تحسين زمن الاستجابة
- [ ] دعم WebSocket للاستجابة الفورية
- [ ] إضافة Authentication للمستخدمين

---

## 13. المراجع (References)

1. OpenAI API Documentation - https://platform.openai.com/docs
2. OpenAI Prompt Engineering Guide - https://platform.openai.com/docs/guides/prompt-engineering
3. FastAPI Documentation - https://fastapi.tiangolo.com
4. Cloudflare Pages Documentation - https://developers.cloudflare.com/pages

---

## 14. الملاحق (Appendices)

### 14.1 قائمة البحور الشعرية المدعومة

| البحر | التفعيلات |
|-------|-----------|
| الطويل | فعولن مفاعيلن فعولن مفاعلن |
| البسيط | مستفعلن فاعلن مستفعلن فعلن |
| الكامل | متفاعلن متفاعلن متفاعلن |
| الوافر | مفاعلتن مفاعلتن فعولن |
| الخفيف | فاعلاتن مستفعلن فاعلاتن |
| الرمل | فاعلاتن فاعلاتن فاعلاتن |
| السريع | مستفعلن مستفعلن مفعولات |
| المنسرح | مستفعلن مفعولات مستفعلن |
| المتقارب | فعولن فعولن فعولن فعولن |
| المتدارك | فاعلن فاعلن فاعلن فاعلن |

---

**إعداد:** فريق تكوين للذكاء الاصطناعي
**التاريخ:** 20 ديسمبر 2025
**الإصدار:** 2.0



